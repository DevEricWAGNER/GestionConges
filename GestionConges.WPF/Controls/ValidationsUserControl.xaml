<UserControl x:Class="GestionConges.WPF.Controls.ValidationsUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Titre -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
            <TextBlock Text="✅" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
            <TextBlock Text="Validation des Demandes"
                     FontSize="20" FontWeight="Bold" VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Barre d'informations et actions -->
        <Border Grid.Row="1" Background="#E3F2FD" BorderBrush="#2196F3" BorderThickness="1" 
                Padding="15" Margin="0,0,0,15" CornerRadius="5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Informations utilisateur -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="👤" FontSize="16" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <StackPanel>
                        <TextBlock Name="TxtValidateurInfo" Text="Validateur connecté"
                                 FontWeight="SemiBold"/>
                        <TextBlock Name="TxtRoleInfo" Text="Rôle"
                                 FontSize="12" Foreground="#1976D2"/>
                    </StackPanel>
                </StackPanel>

                <!-- Statistiques -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <Border Background="#4CAF50" CornerRadius="15" Padding="10,5" Margin="5">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="⏳" Foreground="White" Margin="0,0,5,0"/>
                            <TextBlock Name="TxtNombreEnAttente" Text="0 en attente" 
                                     Foreground="White" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Border>
                    <Border Background="#FF9800" CornerRadius="15" Padding="10,5" Margin="5">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="📊" Foreground="White" Margin="0,0,5,0"/>
                            <TextBlock Name="TxtNombreTotal" Text="0 total" 
                                     Foreground="White" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- Bouton actualiser -->
                <Button Grid.Column="2" Name="BtnActualiser" 
                        Content="🔄 Actualiser"
                        Background="#2196F3" Foreground="White" BorderThickness="0"
                        Padding="15,8"
                        Click="BtnActualiser_Click"/>
            </Grid>
        </Border>

        <!-- Liste des demandes à valider -->
        <Border Grid.Row="2" BorderBrush="#DDDDDD" BorderThickness="1" Background="White">
            <DataGrid Name="DgDemandesAValider" 
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    GridLinesVisibility="Horizontal"
                    HeadersVisibility="Column"
                    SelectionMode="Single"
                    SelectionChanged="DgDemandesAValider_SelectionChanged"
                    MouseDoubleClick="DgDemandesAValider_MouseDoubleClick">

                <DataGrid.Columns>
                    <!-- Priorité/urgence -->
                    <DataGridTemplateColumn Header="🔥" Width="40">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock HorizontalAlignment="Center">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Style.Triggers>
                                                <!-- Urgence selon l'ancienneté -->
                                                <DataTrigger Binding="{Binding IsUrgent}" Value="True">
                                                    <Setter Property="Text" Value="🔥"/>
                                                    <Setter Property="ToolTip" Value="Demande ancienne (> 3 jours)"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding IsUrgent}" Value="False">
                                                    <Setter Property="Text" Value=""/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Demandeur -->
                    <DataGridTemplateColumn Header="👤 Demandeur" Width="150">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="{Binding Utilisateur.NomComplet}" FontWeight="SemiBold" Foreground="Black"/>
                                    <TextBlock Text="{Binding Utilisateur.Pole.Nom}" FontSize="11" Foreground="Gray"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Type avec couleur -->
                    <DataGridTemplateColumn Header="🏷️ Type" Width="130">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Border Width="16" Height="12" Background="{Binding TypeAbsence.CouleurHex}" 
                                          Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding TypeAbsence.Nom}" VerticalAlignment="Center" Foreground="Black"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="📅 Du" Binding="{Binding DateDebut, StringFormat='dd/MM/yyyy'}" Width="90">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="Black"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="📅 Au" Binding="{Binding DateFin, StringFormat='dd/MM/yyyy'}" Width="90">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="Black"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="⏱️ Durée" Binding="{Binding NombreJours, StringFormat='{}{0} j'}" Width="70">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="Black"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="💬 Commentaire" Binding="{Binding Commentaire}" Width="200">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="Black"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn Header="📝 Demandée le" Binding="{Binding DateCreation, StringFormat='dd/MM/yyyy HH:mm'}" Width="120">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="Black"/>
                                <Setter Property="VerticalAlignment" Value="Center"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Ancienneté -->
                    <DataGridTemplateColumn Header="⏰ Ancienneté" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding AncienneteTexte}" 
                                         HorizontalAlignment="Center"
                                         VerticalAlignment="Center"
                                         Foreground="{Binding AncienneteCouleur}"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>

                <!-- Style des lignes selon urgence -->
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsUrgent}" Value="True">
                                <Setter Property="Background" Value="#FFEBEE"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>

                <!-- Style des cellules pour éviter les problèmes de couleur -->
                <DataGrid.CellStyle>
                    <Style TargetType="DataGridCell">
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#E3F2FD"/>
                                <Setter Property="BorderBrush" Value="#2196F3"/>
                                <Setter Property="Foreground" Value="Black"/>
                            </Trigger>
                        </Style.Triggers>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="8,4"/>
                    </Style>
                </DataGrid.CellStyle>
            </DataGrid>
        </Border>

        <!-- Panneau de validation -->
        <Border Grid.Row="3" Background="#F8F8F8" BorderBrush="#DDDDDD" BorderThickness="1,1,1,0" 
                Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Boutons de validation -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button Name="BtnApprouver" Content="✅ Approuver"
                            Background="#4CAF50" Foreground="White" BorderThickness="0"
                            Padding="20,10" Margin="0,0,10,0"
                            IsEnabled="False" Click="BtnApprouver_Click"/>

                    <Button Name="BtnRefuser" Content="❌ Refuser"
                            Background="#F44336" Foreground="White" BorderThickness="0"
                            Padding="20,10" Margin="0,0,15,0"
                            IsEnabled="False" Click="BtnRefuser_Click"/>

                    <Button Name="BtnVoirDetails" Content="👁️ Détails"
                            Background="#2196F3" Foreground="White" BorderThickness="0"
                            Padding="20,10"
                            IsEnabled="False" Click="BtnVoirDetails_Click"/>
                </StackPanel>

                <!-- Zone commentaire rapide -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock Text="💬 Commentaire :" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <TextBox Name="TxtCommentaireRapide" Width="300" Padding="5"
                           Text="Commentaire optionnel..."
                           Foreground="Gray"
                           GotFocus="TxtCommentaireRapide_GotFocus"
                           LostFocus="TxtCommentaireRapide_LostFocus"/>
                </StackPanel>

                <!-- Informations -->
                <TextBlock Grid.Column="2" Name="TxtInfoSelection" 
                         Text="Sélectionnez une demande pour la valider"
                         FontStyle="Italic" Foreground="Gray" VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>