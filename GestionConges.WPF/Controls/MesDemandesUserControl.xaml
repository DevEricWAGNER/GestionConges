<UserControl x:Class="GestionConges.WPF.Controls.MesDemandesUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Titre -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
            <TextBlock Text="📅" FontSize="24" VerticalAlignment="Center" Margin="0,0,10,0"/>
            <TextBlock Text="Mes Demandes de Congés"
                     FontSize="20" FontWeight="Bold" VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Barre d'actions et filtres -->
        <Border Grid.Row="1" Background="#F5F5F5" BorderBrush="#DDDDDD" BorderThickness="1" Padding="15" Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Bouton nouvelle demande -->
                <Button Grid.Column="0" Name="BtnNouvelleDemande" 
                        Content="➕ Nouvelle Demande"
                        Background="#4CAF50" Foreground="White" BorderThickness="0"
                        Padding="15,8" Margin="0,0,15,0"
                        Click="BtnNouvelleDemande_Click"/>

                <!-- Filtres -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <TextBlock Text="Filtrer :" VerticalAlignment="Center" Margin="0,0,10,0"/>
                    <ComboBox Name="CmbFiltreStatut" Width="150" Padding="5" Margin="0,0,15,0"
                            SelectionChanged="CmbFiltreStatut_SelectionChanged">
                        <ComboBoxItem Content="Tous les statuts" IsSelected="True"/>
                        <ComboBoxItem Content="Brouillons" Tag="Brouillon"/>
                        <ComboBoxItem Content="En attente" Tag="EnAttente"/>
                        <ComboBoxItem Content="Approuvés" Tag="Approuve"/>
                        <ComboBoxItem Content="Refusés" Tag="Refuse"/>
                    </ComboBox>

                    <ComboBox Name="CmbFiltreAnnee" Width="100" Padding="5"
                            SelectionChanged="CmbFiltreAnnee_SelectionChanged"/>
                </StackPanel>

                <!-- Bouton actualiser -->
                <Button Grid.Column="2" Name="BtnActualiser" 
                        Content="🔄 Actualiser"
                        Background="#2196F3" Foreground="White" BorderThickness="0"
                        Padding="12,8"
                        Click="BtnActualiser_Click"/>
            </Grid>
        </Border>

        <!-- Liste des demandes -->
        <Border Grid.Row="2" BorderBrush="#DDDDDD" BorderThickness="1" Background="White">
            <DataGrid Name="DgDemandes" 
                    AutoGenerateColumns="False"
                    IsReadOnly="True"
                    GridLinesVisibility="Horizontal"
                    HeadersVisibility="Column"
                    SelectionMode="Single"
                    SelectionChanged="DgDemandes_SelectionChanged"
                    MouseDoubleClick="DgDemandes_MouseDoubleClick">

                <!-- Menu contextuel -->
                <DataGrid.ContextMenu>
                    <ContextMenu Name="MenuContextuel" Opened="MenuContextuel_Opened">
                        <MenuItem Name="MenuVoirDetails" Header="👁️ Voir les détails" Click="MenuVoirDetails_Click"/>
                        <Separator/>
                        <MenuItem Name="MenuModifier" Header="✏️ Modifier" Click="MenuModifier_Click"/>
                        <MenuItem Name="MenuDupliquer" Header="📋 Dupliquer" Click="MenuDupliquer_Click"/>
                        <Separator/>
                        <MenuItem Name="MenuSupprimer" Header="🗑️ Supprimer" Click="MenuSupprimer_Click"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>
                AutoGenerateColumns="False"
                    IsReadOnly="True"
                    GridLinesVisibility="Horizontal"
                    HeadersVisibility="Column"
                    SelectionMode="Single"
                    SelectionChanged="DgDemandes_SelectionChanged"
                    MouseDoubleClick="DgDemandes_MouseDoubleClick">
                <DataGrid.Columns>
                    <!-- Statut avec couleur -->
                    <DataGridTemplateColumn Header="📊 Statut" Width="120">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Padding="8,4" CornerRadius="3" Margin="2">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Statut}" Value="Brouillon">
                                                    <Setter Property="Background" Value="#EEEEEE"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Statut}" Value="EnAttenteChefPole">
                                                    <Setter Property="Background" Value="#FFF3E0"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Statut}" Value="EnAttenteChefEquipe">
                                                    <Setter Property="Background" Value="#E3F2FD"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Statut}" Value="Approuve">
                                                    <Setter Property="Background" Value="#E8F5E8"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Statut}" Value="Refuse">
                                                    <Setter Property="Background" Value="#FFEBEE"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding StatutLibelle}" 
                                             FontWeight="SemiBold" FontSize="11" 
                                             HorizontalAlignment="Center"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Type avec couleur -->
                    <DataGridTemplateColumn Header="🏷️ Type" Width="130">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <Border Width="16" Height="12" Background="{Binding TypeAbsence.CouleurHex}" 
                                          Margin="0,0,8,0" VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding TypeAbsence.Nom}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <DataGridTextColumn Header="📅 Du" Binding="{Binding DateDebut, StringFormat='dd/MM/yyyy'}" Width="90"/>
                    <DataGridTextColumn Header="📅 Au" Binding="{Binding DateFin, StringFormat='dd/MM/yyyy'}" Width="90"/>
                    <DataGridTextColumn Header="⏱️ Durée" Binding="{Binding NombreJours, StringFormat='{}{0} j'}" Width="70"/>
                    <DataGridTextColumn Header="💬 Commentaire" Binding="{Binding Commentaire}" Width="200"/>
                    <DataGridTextColumn Header="📝 Créée le" Binding="{Binding DateCreation, StringFormat='dd/MM/yyyy HH:mm'}" Width="120"/>
                    <DataGridTextColumn Header="✏️ Modifiée le" Binding="{Binding DateModification, StringFormat='dd/MM/yyyy HH:mm'}" Width="120"/>
                </DataGrid.Columns>

                <!-- Style des lignes selon le statut -->
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding Statut}" Value="Refuse">
                                <Setter Property="Opacity" Value="0.7"/>
                            </DataTrigger>
                            <DataTrigger Binding="{Binding Statut}" Value="Brouillon">
                                <Setter Property="FontStyle" Value="Italic"/>
                            </DataTrigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#E3F2FD"/>
                                <Setter Property="BorderBrush" Value="#2196F3"/>
                                <Setter Property="BorderThickness" Value="1"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>

                <!-- Style des cellules pour éviter l'override de la sélection -->
                <DataGrid.CellStyle>
                    <Style TargetType="DataGridCell">
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderBrush" Value="Transparent"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.CellStyle>
            </DataGrid>
        </Border>

        <!-- Barre d'actions pour les demandes sélectionnées -->
        <Border Grid.Row="3" Background="#F8F8F8" BorderBrush="#DDDDDD" BorderThickness="1,1,1,0" Padding="15">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                <Button Name="BtnModifier" Content="✏️ Modifier"
                        Background="#FF9800" Foreground="White" BorderThickness="0"
                        Padding="15,8" Margin="0,0,10,0"
                        IsEnabled="False" Click="BtnModifier_Click"/>

                <Button Name="BtnDupliquer" Content="📋 Dupliquer"
                        Background="#9C27B0" Foreground="White" BorderThickness="0"
                        Padding="15,8" Margin="0,0,10,0"
                        IsEnabled="False" Click="BtnDupliquer_Click"/>

                <Button Name="BtnSupprimer" Content="🗑️ Supprimer"
                        Background="#F44336" Foreground="White" BorderThickness="0"
                        Padding="15,8" Margin="0,0,20,0"
                        IsEnabled="False" Click="BtnSupprimer_Click"/>

                <!-- Informations -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Name="TxtNombreDemandes" Text="0 demande(s)" 
                             FontWeight="SemiBold" VerticalAlignment="Center" Margin="0,0,20,0"/>
                    <TextBlock Name="TxtTotalJours" Text="0 jour(s) demandé(s)" 
                             VerticalAlignment="Center" Margin="0,0,20,0"/>
                    <TextBlock Text="💡 Double-clic pour voir les détails" 
                             FontStyle="Italic" Foreground="Gray" VerticalAlignment="Center"/>
                </StackPanel>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>