<Window x:Class="GestionConges.WPF.Views.NouvelleDemandeWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Nouvelle Demande de Congés" 
        Height="750" Width="600"
        WindowStartupLocation="CenterScreen"
        Background="Transparent"
        ResizeMode="NoResize"
        WindowStyle="None"
        AllowsTransparency="True">

    <Border CornerRadius="16" Background="{StaticResource Background}"
            BorderBrush="{StaticResource Gray300}" BorderThickness="1"
            Effect="{StaticResource ShadowLarge}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Border Grid.Row="0" Background="{StaticResource Surface}" 
                    CornerRadius="16,16,0,0" 
                    BorderBrush="{StaticResource Gray200}" 
                    BorderThickness="0,0,0,1"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid Height="60" Margin="24,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Logo et titre -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" 
                              VerticalAlignment="Center">
                        <Border Background="{StaticResource Primary}" 
                              Width="40" Height="40" 
                              CornerRadius="12" Margin="0,0,16,0">
                            <TextBlock Text="📝" FontSize="20" 
                                     Foreground="White"
                                     HorizontalAlignment="Center" 
                                     VerticalAlignment="Center"/>
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Nouvelle Demande" 
                                     FontSize="18" FontWeight="SemiBold" 
                                     Foreground="{StaticResource TextPrimary}"/>
                            <TextBlock Text="Formulaire de congés" 
                                     FontSize="12" 
                                     Foreground="{StaticResource TextMuted}"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Bouton fermer -->
                    <Button Grid.Column="2" Content="✕" 
                          Width="36" Height="36" 
                          Background="Transparent" 
                          BorderThickness="0" 
                          Foreground="{StaticResource Gray400}"
                          FontSize="16" FontWeight="Bold"
                          Cursor="Hand"
                          Click="BtnClose_Click"/>
                </Grid>
            </Border>

            <!-- Contenu principal -->
            <ScrollViewer Grid.Row="1" Padding="32" Background="{StaticResource Background}">
                <StackPanel MaxWidth="500">

                    <!-- Section Demandeur -->
                    <Border Style="{StaticResource Card}" Margin="0,0,0,24">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="{StaticResource Secondary}" 
                                      Width="32" Height="32" 
                                      CornerRadius="8" Margin="0,0,12,0">
                                    <TextBlock Text="👤" FontSize="16" 
                                             Foreground="White"
                                             HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Informations du demandeur" 
                                         FontSize="16" FontWeight="SemiBold" 
                                         Foreground="{StaticResource TextPrimary}"
                                         VerticalAlignment="Center"/>
                            </StackPanel>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Nom complet" 
                                             FontSize="14" FontWeight="SemiBold"
                                             Foreground="{StaticResource TextPrimary}" 
                                             Margin="0,0,0,8"/>
                                    <TextBox Name="TxtNomDemandeur" 
                                           Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                           IsReadOnly="True" 
                                           Background="{StaticResource Gray50}"
                                           Foreground="{StaticResource TextSecondary}"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Pôle d'affectation" 
                                             FontSize="14" FontWeight="SemiBold"
                                             Foreground="{StaticResource TextPrimary}" 
                                             Margin="0,0,0,8"/>
                                    <TextBox Name="TxtPoleDemandeur" 
                                           Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                           IsReadOnly="True" 
                                           Background="{StaticResource Gray50}"
                                           Foreground="{StaticResource TextSecondary}"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Section Type d'absence -->
                    <Border Style="{StaticResource Card}" Margin="0,0,0,24">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="{StaticResource Warning}" 
                                      Width="32" Height="32" 
                                      CornerRadius="8" Margin="0,0,12,0">
                                    <TextBlock Text="🏷️" FontSize="16" 
                                             Foreground="White"
                                             HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Type d'absence" 
                                         FontSize="16" FontWeight="SemiBold" 
                                         Foreground="{StaticResource TextPrimary}"
                                         VerticalAlignment="Center"/>
                            </StackPanel>

                            <ComboBox Name="CmbTypeAbsence" 
                                    Height="55"
                                    FontSize="14"
                                    Background="{StaticResource Surface}"
                                    BorderBrush="{StaticResource Gray300}"
                                    BorderThickness="1"
                                    Padding="16,8"
                                    VerticalContentAlignment="Center"
                                    SelectionChanged="CmbTypeAbsence_SelectionChanged">
                                <ComboBox.Style>
                                    <Style TargetType="ComboBox">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ComboBox">
                                                    <Border x:Name="Border"
                                                            Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="8"
                                                            Padding="{TemplateBinding Padding}">
                                                        <Grid>
                                                            <ToggleButton x:Name="ToggleButton"
                                                                        Background="Transparent"
                                                                        BorderThickness="0"
                                                                        IsChecked="{Binding Path=IsDropDownOpen, RelativeSource={RelativeSource TemplatedParent}}"
                                                                        ClickMode="Press"/>
                                                            <ContentPresenter x:Name="ContentSite"
                                                                            IsHitTestVisible="False"
                                                                            Content="{TemplateBinding SelectionBoxItem}"
                                                                            ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                                                            ContentTemplateSelector="{TemplateBinding ItemTemplateSelector}"
                                                                            VerticalAlignment="Center"
                                                                            HorizontalAlignment="Left"/>
                                                            <Popup x:Name="Popup"
                                                                 Placement="Bottom"
                                                                 IsOpen="{TemplateBinding IsDropDownOpen}"
                                                                 AllowsTransparency="True"
                                                                 Focusable="False"
                                                                 PopupAnimation="Slide">
                                                                <Border Background="{StaticResource Surface}"
                                                                      BorderBrush="{StaticResource Gray300}"
                                                                      BorderThickness="1"
                                                                      CornerRadius="8"
                                                                      Effect="{StaticResource ShadowMedium}">
                                                                    <ScrollViewer MaxHeight="200">
                                                                        <ItemsPresenter/>
                                                                    </ScrollViewer>
                                                                </Border>
                                                            </Popup>
                                                        </Grid>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource Primary}"/>
                                                        </Trigger>
                                                        <Trigger Property="IsFocused" Value="True">
                                                            <Setter TargetName="Border" Property="BorderBrush" Value="{StaticResource Primary}"/>
                                                            <Setter TargetName="Border" Property="BorderThickness" Value="2"/>
                                                        </Trigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ComboBox.Style>
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" Margin="8">
                                            <Border Width="20" Height="15" Background="{Binding CouleurHex}" 
                                                  CornerRadius="3" Margin="0,0,12,0" VerticalAlignment="Center"/>
                                            <TextBlock Text="{Binding Nom}" VerticalAlignment="Center"
                                                     FontSize="14" Foreground="{StaticResource TextPrimary}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>
                        </StackPanel>
                    </Border>

                    <!-- Section Conflits -->
                    <Border Name="PanneauConflits" 
                          Background="{StaticResource Surface}"
                          BorderBrush="{StaticResource Danger}" 
                          BorderThickness="2"
                          CornerRadius="12" 
                          Padding="20" 
                          Margin="0,0,0,24" 
                          Visibility="Collapsed">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                <Border Background="{StaticResource Danger}" 
                                      Width="32" Height="32" 
                                      CornerRadius="8" Margin="0,0,12,0">
                                    <TextBlock Text="⚠️" FontSize="16" 
                                             Foreground="White"
                                             HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"/>
                                </Border>
                                <StackPanel VerticalAlignment="Center">
                                    <TextBlock Text="Attention - Conflits détectés" 
                                             FontWeight="Bold" FontSize="14" 
                                             Foreground="{StaticResource Danger}"/>
                                    <TextBlock Text="Vérifiez vos dates avec les demandes existantes" 
                                             FontSize="12" 
                                             Foreground="{StaticResource TextMuted}"/>
                                </StackPanel>
                            </StackPanel>
                            <TextBlock Name="TxtConflits" 
                                     TextWrapping="Wrap" 
                                     FontSize="13"
                                     Foreground="{StaticResource TextSecondary}"/>
                        </StackPanel>
                    </Border>

                    <!-- Section Période -->
                    <Border Style="{StaticResource Card}" Margin="0,0,0,24">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="{StaticResource Primary}" 
                                      Width="32" Height="32" 
                                      CornerRadius="8" Margin="0,0,12,0">
                                    <TextBlock Text="📅" FontSize="16" 
                                             Foreground="White"
                                             HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Période d'absence" 
                                         FontSize="16" FontWeight="SemiBold" 
                                         Foreground="{StaticResource TextPrimary}"
                                         VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Date de début -->
                            <Grid Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="160"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Date de début" 
                                             FontSize="14" FontWeight="SemiBold"
                                             Foreground="{StaticResource TextPrimary}" 
                                             Margin="0,0,0,8"/>
                                    <DatePicker Name="DpDateDebut" 
                                              Height="48"
                                              FontSize="14"
                                              Background="{StaticResource Surface}"
                                              BorderBrush="{StaticResource Gray300}"
                                              BorderThickness="1"
                                              Padding="16,12"
                                              SelectedDateChanged="DpDateDebut_SelectedDateChanged"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Type de journée" 
                                             FontSize="14" FontWeight="SemiBold"
                                             Foreground="{StaticResource TextPrimary}" 
                                             Margin="0,0,0,8"/>
                                    <ComboBox Name="CmbTypeJourneeDebut" 
                                            Height="48"
                                            FontSize="12"
                                            Background="{StaticResource Surface}"
                                            BorderBrush="{StaticResource Gray300}"
                                            BorderThickness="1"
                                            Padding="12,12">
                                        <ComboBoxItem Content="Journée complète" IsSelected="True"/>
                                        <ComboBoxItem Content="Matin seulement"/>
                                        <ComboBoxItem Content="Après-midi seulement"/>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>

                            <!-- Date de fin -->
                            <Grid Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="160"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Date de fin" 
                                             FontSize="14" FontWeight="SemiBold"
                                             Foreground="{StaticResource TextPrimary}" 
                                             Margin="0,0,0,8"/>
                                    <DatePicker Name="DpDateFin" 
                                              Height="48"
                                              FontSize="14"
                                              Background="{StaticResource Surface}"
                                              BorderBrush="{StaticResource Gray300}"
                                              BorderThickness="1"
                                              Padding="16,12"
                                              SelectedDateChanged="DpDateFin_SelectedDateChanged"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Type de journée" 
                                             FontSize="14" FontWeight="SemiBold"
                                             Foreground="{StaticResource TextPrimary}" 
                                             Margin="0,0,0,8"/>
                                    <ComboBox Name="CmbTypeJourneeFin" 
                                            Height="48"
                                            FontSize="12"
                                            Background="{StaticResource Surface}"
                                            BorderBrush="{StaticResource Gray300}"
                                            BorderThickness="1"
                                            Padding="12,12">
                                        <ComboBoxItem Content="Journée complète" IsSelected="True"/>
                                        <ComboBoxItem Content="Matin seulement"/>
                                        <ComboBoxItem Content="Après-midi seulement"/>
                                    </ComboBox>
                                </StackPanel>
                            </Grid>

                            <!-- Calcul automatique -->
                            <Border Background="{StaticResource Secondary}" 
                                  CornerRadius="12" 
                                  Padding="20">
                                <Border.Effect>
                                    <DropShadowEffect Color="#10B981" 
                                                    Opacity="0.2" ShadowDepth="0" BlurRadius="20"/>
                                </Border.Effect>
                                <StackPanel Orientation="Horizontal">
                                    <Border Background="White" 
                                          Width="40" Height="40" 
                                          CornerRadius="20" 
                                          Margin="0,0,16,0">
                                        <TextBlock Text="📊" FontSize="18" 
                                                 HorizontalAlignment="Center" 
                                                 VerticalAlignment="Center"/>
                                    </Border>
                                    <StackPanel VerticalAlignment="Center">
                                        <TextBlock Name="TxtNombreJours" 
                                                 Text="Durée calculée : 0 jour(s)" 
                                                 FontWeight="Bold" FontSize="16"
                                                 Foreground="White"/>
                                        <TextBlock Name="TxtDetailsCalcul" 
                                                 Text="Sélectionnez les dates pour voir le calcul"
                                                 FontSize="12" 
                                                 Foreground="White" 
                                                 Opacity="0.8"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Border>

                    <!-- Section Commentaire -->
                    <Border Style="{StaticResource Card}" Margin="0,0,0,24">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                                <Border Background="{StaticResource Gray600}" 
                                      Width="32" Height="32" 
                                      CornerRadius="8" Margin="0,0,12,0">
                                    <TextBlock Text="💬" FontSize="16" 
                                             Foreground="White"
                                             HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Commentaire (optionnel)" 
                                         FontSize="16" FontWeight="SemiBold" 
                                         Foreground="{StaticResource TextPrimary}"
                                         VerticalAlignment="Center"/>
                            </StackPanel>

                            <TextBox Name="TxtCommentaire" 
                                   Height="100" 
                                   TextWrapping="Wrap" 
                                   AcceptsReturn="True"
                                   VerticalScrollBarVisibility="Auto"
                                   Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                   VerticalContentAlignment="Top"
                                   MaxLength="1000"/>

                            <TextBlock Text="Ajoutez des informations supplémentaires si nécessaire" 
                                     FontStyle="Italic" FontSize="12" 
                                     Foreground="{StaticResource TextMuted}" 
                                     Margin="0,8,0,0"/>
                        </StackPanel>
                    </Border>

                </StackPanel>
            </ScrollViewer>

            <!-- Boutons d'action -->
            <Border Grid.Row="2" 
                    Background="{StaticResource Surface}" 
                    BorderBrush="{StaticResource Gray200}" 
                    BorderThickness="0,1,0,0" 
                    CornerRadius="0,0,16,16"
                    Padding="32,20">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button Name="BtnSauvegarderBrouillon" 
                          Content="📄 Sauver brouillon"
                          Background="{StaticResource Gray500}" 
                          Foreground="White" 
                          BorderThickness="0"
                          Style="{StaticResource MaterialDesignRaisedButton}"
                          Padding="24,12" 
                          Margin="0,0,12,0"
                          Click="BtnSauvegarderBrouillon_Click"/>

                    <Button Name="BtnSoumettre" 
                          Content="📤 Soumettre la demande"
                          Style="{StaticResource MaterialDesignRaisedButton}"
                          Padding="24,12" 
                          Margin="0,0,12,0"
                          Click="BtnSoumettre_Click"/>

                    <Button Name="BtnAnnuler" 
                          Content="❌ Annuler"
                          Style="{StaticResource DangerButton}"
                          Padding="24,12"
                          Click="BtnAnnuler_Click"/>
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</Window>