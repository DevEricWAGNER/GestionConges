<Window x:Class="GestionConges.WPF.Views.GestionSocietesWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Gestion des Sociétés - Administration" 
        Height="800" Width="1300"
        WindowStartupLocation="CenterScreen"
        Background="Transparent"
        ResizeMode="CanResize"
        WindowStyle="None"
        AllowsTransparency="True">

    <Border CornerRadius="16" Background="{StaticResource Background}"
            BorderBrush="{StaticResource Gray300}" BorderThickness="1"
            Effect="{StaticResource ShadowLarge}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Custom Title Bar -->
            <Border Grid.Row="0" Background="{StaticResource Surface}" 
                    CornerRadius="16,16,0,0" 
                    BorderBrush="{StaticResource Gray200}" 
                    BorderThickness="0,0,0,1"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid Height="60" Margin="24,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Logo et titre -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" 
                              VerticalAlignment="Center">
                        <Border Background="{StaticResource Secondary}" 
                              Width="40" Height="40" 
                              CornerRadius="12" Margin="0,0,16,0">
                            <TextBlock Text="🏢" FontSize="20" 
                                     Foreground="White"
                                     HorizontalAlignment="Center" 
                                     VerticalAlignment="Center"/>
                        </Border>
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="Gestion des Sociétés" 
                                     FontSize="18" FontWeight="SemiBold" 
                                     Foreground="{StaticResource TextPrimary}"/>
                            <TextBlock Text="Administration des sociétés de l'organisation" 
                                     FontSize="12" 
                                     Foreground="{StaticResource TextMuted}"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Boutons fenêtre -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" 
                              VerticalAlignment="Center">
                        <Button Name="BtnMinimize" Content="−" 
                              Width="32" Height="32" 
                              Background="Transparent" 
                              BorderThickness="0" 
                              Foreground="{StaticResource Gray400}"
                              FontSize="16" FontWeight="Bold"
                              Margin="0,0,4,0"
                              Click="BtnMinimize_Click"/>
                        <Button Name="BtnClose" Content="✕" 
                              Width="32" Height="32" 
                              Background="Transparent" 
                              BorderThickness="0" 
                              Foreground="{StaticResource Gray400}"
                              FontSize="14" FontWeight="Bold"
                              Click="BtnClose_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Contenu principal -->
            <Grid Grid.Row="1" Margin="32,20,32,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="24"/>
                    <ColumnDefinition Width="1.5*"/>
                </Grid.ColumnDefinitions>

                <!-- Liste des sociétés -->
                <Border Grid.Column="0" Style="{StaticResource Card}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- En-tête avec titre -->
                        <Border Grid.Row="0" 
                                Background="{StaticResource Secondary}" 
                                CornerRadius="8,8,0,0" 
                                Padding="20,16">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <Border Background="White" 
                                      Width="28" Height="28" 
                                      CornerRadius="8" Margin="0,0,12,0">
                                    <TextBlock Text="🏢" FontSize="14" 
                                             HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Liste des Sociétés" 
                                         FontWeight="SemiBold" FontSize="16" 
                                         Foreground="White"
                                         VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>

                        <!-- DataGrid des sociétés -->
                        <DataGrid Grid.Row="1" Name="DgSocietes" 
                                AutoGenerateColumns="False"
                                IsReadOnly="True"
                                GridLinesVisibility="None"
                                HeadersVisibility="Column"
                                SelectionMode="Single"
                                SelectionChanged="DgSocietes_SelectionChanged"
                                Background="{StaticResource Surface}"
                                BorderThickness="0"
                                RowHeight="56"
                                AlternatingRowBackground="{StaticResource Gray50}"
                                AlternationCount="2">

                            <DataGrid.Resources>
                                <!-- Style pour les en-têtes -->
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="{StaticResource Gray100}"/>
                                    <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="FontSize" Value="13"/>
                                    <Setter Property="Padding" Value="16,12"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Height" Value="44"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Left"/>
                                    <Setter Property="VerticalContentAlignment" Value="Center"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="DataGridColumnHeader">
                                                <Border Background="{TemplateBinding Background}"
                                                        BorderBrush="{StaticResource Gray200}"
                                                        BorderThickness="0,0,0,1"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                    VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>

                                <!-- Style pour les cellules -->
                                <Style TargetType="DataGridCell">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Padding" Value="16,8"/>
                                    <Setter Property="VerticalAlignment" Value="Center"/>
                                    <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="DataGridCell">
                                                <Border Background="{TemplateBinding Background}"
                                                        BorderThickness="0"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter VerticalAlignment="Center"/>
                                                </Border>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="Foreground" Value="White"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGrid.Resources>

                            <DataGrid.Columns>
                                <!-- Nom -->
                                <DataGridTextColumn Header="🏢 Nom de la Société" Binding="{Binding Nom}" Width="200">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <!-- Description -->
                                <DataGridTextColumn Header="📝 Description" Binding="{Binding Description}" Width="300">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
                                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <!-- Équipes -->
                                <DataGridTextColumn Header="🏛️ Équipes" Binding="{Binding Equipes.Count}" Width="100">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="Foreground" Value="{StaticResource Primary}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <!-- Employés principaux -->
                                <DataGridTextColumn Header="👥 Employés" Binding="{Binding EmployesPrincipaux.Count}" Width="100">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="HorizontalAlignment" Value="Center"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                            <Setter Property="Foreground" Value="{StaticResource Secondary}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>

                                <!-- Date de création -->
                                <DataGridTextColumn Header="📅 Créée le" Width="140">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                    <DataGridTextColumn.Binding>
                                        <Binding Path="DateCreation" StringFormat="{}{0:dd/MM/yyyy}"/>
                                    </DataGridTextColumn.Binding>
                                </DataGridTextColumn>

                                <!-- Actif -->
                                <DataGridTemplateColumn Header="🔄 Statut" Width="100">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="12" 
                                                  Padding="8,4"
                                                  HorizontalAlignment="Center">
                                                <Border.Style>
                                                    <Style TargetType="Border">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Actif}" Value="True">
                                                                <Setter Property="Background" Value="{StaticResource Secondary}"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Actif}" Value="False">
                                                                <Setter Property="Background" Value="{StaticResource Gray400}"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Border.Style>
                                                <TextBlock FontSize="12" 
                                                         FontWeight="SemiBold"
                                                         Foreground="White"
                                                         HorizontalAlignment="Center">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Actif}" Value="True">
                                                                    <Setter Property="Text" Value="Active"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Actif}" Value="False">
                                                                    <Setter Property="Text" Value="Inactive"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Border>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>

                            <!-- Style des lignes -->
                            <DataGrid.RowStyle>
                                <Style TargetType="DataGridRow">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="BorderThickness" Value="0"/>
                                    <Setter Property="Margin" Value="0"/>
                                    <Setter Property="Padding" Value="0"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="DataGridRow">
                                                <Border Name="RowBorder"
                                                        Background="{TemplateBinding Background}"
                                                        BorderThickness="0"
                                                        CornerRadius="6"
                                                        Margin="8,2"
                                                        Padding="8,0">
                                                    <SelectiveScrollingGrid>
                                                        <SelectiveScrollingGrid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </SelectiveScrollingGrid.ColumnDefinitions>
                                                        <DataGridCellsPresenter Grid.Column="1"
                                                                              ItemsPanel="{TemplateBinding ItemsPanel}"
                                                                              SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                                        <DataGridDetailsPresenter Grid.Column="1"
                                                                                Grid.Row="1"
                                                                                SelectiveScrollingGrid.SelectiveScrollingOrientation="{Binding AreRowDetailsFrozen, ConverterParameter={x:Static SelectiveScrollingOrientation.Vertical}, Converter={x:Static DataGrid.RowDetailsScrollingConverter}, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                                                                                Visibility="{TemplateBinding DetailsVisibility}"/>
                                                        <DataGridRowHeader Grid.RowSpan="2"
                                                                         SelectiveScrollingGrid.SelectiveScrollingOrientation="Vertical"
                                                                         Visibility="{Binding HeadersVisibility, ConverterParameter={x:Static DataGridHeadersVisibility.Row}, Converter={x:Static DataGrid.HeadersVisibilityConverter}, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"/>
                                                    </SelectiveScrollingGrid>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding Actif}" Value="False">
                                                        <Setter Property="Opacity" Value="0.6"/>
                                                    </DataTrigger>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter TargetName="RowBorder" Property="Background" Value="{StaticResource Secondary}"/>
                                                    </Trigger>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="RowBorder" Property="Background" Value="{StaticResource Gray100}"/>
                                                    </Trigger>
                                                    <MultiTrigger>
                                                        <MultiTrigger.Conditions>
                                                            <Condition Property="IsSelected" Value="True"/>
                                                            <Condition Property="IsMouseOver" Value="True"/>
                                                        </MultiTrigger.Conditions>
                                                        <Setter TargetName="RowBorder" Property="Background" Value="{StaticResource SecondaryHover}"/>
                                                    </MultiTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </DataGrid.RowStyle>
                        </DataGrid>

                        <!-- Boutons d'action -->
                        <Border Grid.Row="2" 
                                Background="{StaticResource Gray50}" 
                                CornerRadius="0,0,8,8"
                                Padding="20,16">
                            <StackPanel Orientation="Horizontal">
                                <Button Name="BtnNouvelleSociete" Content="+ Nouvelle Société"
                                      Style="{StaticResource SecondaryButton}"
                                      Padding="16,8" 
                                      Margin="0,0,8,0" 
                                      Click="BtnNouvelleSociete_Click"/>
                                <Button Name="BtnModifier" Content="✏️ Modifier"
                                      Style="{StaticResource MaterialDesignRaisedButton}"
                                      Background="{StaticResource Warning}"
                                      Padding="16,8" 
                                      Margin="0,0,8,0" 
                                      IsEnabled="False" 
                                      Click="BtnModifier_Click"/>
                                <Button Name="BtnSupprimer" Content="🗑️ Supprimer"
                                      Style="{StaticResource DangerButton}"
                                      Padding="16,8" 
                                      Margin="0,0,8,0" 
                                      IsEnabled="False" 
                                      Click="BtnSupprimer_Click"/>
                                <Button Name="BtnActiver" Content="🔄 Activer/Désactiver"
                                      Style="{StaticResource MaterialDesignOutlineButton}"
                                      Padding="16,8" 
                                      IsEnabled="False" 
                                      Click="BtnActiver_Click"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>

                <!-- Panneau de détail/édition -->
                <Border Grid.Column="2" Style="{StaticResource Card}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Name="PanneauDetail" Margin="4">
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,24">
                                <Border Background="{StaticResource Primary}" 
                                      Width="32" Height="32" 
                                      CornerRadius="8" Margin="0,0,12,0">
                                    <TextBlock Text="📝" FontSize="16" 
                                             Foreground="White"
                                             HorizontalAlignment="Center" 
                                             VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Text="Détails / Édition" 
                                         FontSize="16" FontWeight="SemiBold" 
                                         Foreground="{StaticResource TextPrimary}"
                                         VerticalAlignment="Center"/>
                            </StackPanel>

                            <!-- Nom -->
                            <TextBlock Text="Nom de la société" 
                                     FontSize="14" FontWeight="SemiBold"
                                     Foreground="{StaticResource TextPrimary}" 
                                     Margin="0,0,0,8"/>
                            <TextBox Name="TxtNom" 
                                   Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                   Margin="0,0,0,20"/>

                            <!-- Description -->
                            <TextBlock Text="Description" 
                                     FontSize="14" FontWeight="SemiBold"
                                     Foreground="{StaticResource TextPrimary}" 
                                     Margin="0,0,0,8"/>
                            <TextBox Name="TxtDescription" 
                                   Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                   Height="80" 
                                   TextWrapping="Wrap" 
                                   AcceptsReturn="True"
                                   VerticalContentAlignment="Top"
                                   VerticalScrollBarVisibility="Auto"
                                   Margin="0,0,0,20"/>

                            <!-- Actif -->
                            <CheckBox Name="ChkActif" 
                                    Content="Société active" 
                                    FontSize="14"
                                    Foreground="{StaticResource TextPrimary}"
                                    Margin="0,0,0,24"/>

                            <!-- Boutons de validation -->
                            <StackPanel Orientation="Horizontal" 
                                      HorizontalAlignment="Center" 
                                      Margin="0,0,0,20">
                                <Button Name="BtnSauvegarder" Content="💾 Sauvegarder"
                                      Style="{StaticResource SecondaryButton}"
                                      Padding="16,10" 
                                      Margin="0,0,8,0" 
                                      Click="BtnSauvegarder_Click" 
                                      IsEnabled="False"/>
                                <Button Name="BtnAnnuler" Content="❌ Annuler"
                                      Background="{StaticResource Gray500}" 
                                      Foreground="White" 
                                      BorderThickness="0"
                                      Style="{StaticResource MaterialDesignRaisedButton}"
                                      Padding="16,10" 
                                      Click="BtnAnnuler_Click" 
                                      IsEnabled="False"/>
                            </StackPanel>

                            <!-- Informations supplémentaires -->
                            <Border Background="{StaticResource Gray50}" 
                                  CornerRadius="8" 
                                  Padding="16"
                                  Margin="0,8,0,0">
                                <TextBlock Name="TxtInfos" 
                                         Text="Sélectionnez une société pour voir les détails"
                                         TextWrapping="Wrap" 
                                         FontStyle="Italic" 
                                         FontSize="13"
                                         Foreground="{StaticResource TextMuted}"/>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </Grid>

            <!-- Bouton Fermer -->
            <Border Grid.Row="2" 
                    Background="{StaticResource Surface}" 
                    BorderBrush="{StaticResource Gray200}" 
                    BorderThickness="0,1,0,0" 
                    CornerRadius="0,0,16,16"
                    Padding="32,16">
                <Button Name="BtnFermer" Content="🚪 Fermer"
                      Style="{StaticResource MaterialDesignOutlineButton}"
                      Padding="20,10"
                      HorizontalAlignment="Right"
                      Click="BtnFermer_Click"/>
            </Border>
        </Grid>
    </Border>
</Window>